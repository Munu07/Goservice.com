{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ service_name }} Providers - GoService</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'main/style.css' %}">
    <!-- Google Font for GoService logo -->
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">

    <style>
        body {
          font-family: 'Poppins', sans-serif;
          background-color: #fff8f0;
          margin: 0;
          padding: 0;
        }
        .logo {
  font-family: 'Pacifico', cursive;
  font-size: 1.9rem;
  color: white;
  cursor: pointer;
  letter-spacing: 1px;
}

       /* Navbar */
    .navbar-custom {
      background: linear-gradient(90deg, #ff9900, #ffb84d);
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    .navbar-brand.logo-text {
      font-family: 'Pacifico', cursive;
      color: #fff !important;
      font-size: 1.9rem;
    }
    .navbar-custom .nav-link {
      color: white !important;
      font-weight: 500;
      transition: all 0.3s;
    }
    .navbar-custom .nav-link:hover {
      color: #333 !important;
      transform: scale(1.05);
    }

    /* Page Header */
    h2 {
      text-align: center;
      color: #ff9900;
      margin-top: 40px;
      font-weight: 700;
      position: relative;
    }
    h2::after {
      content: "";
      position: absolute;
      width: 100px;
      height: 4px;
      background: #ff9900;
      left: 50%;
      transform: translateX(-50%);
      bottom: -10px;
      border-radius: 5px;
    }

        .providers-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
          gap: 30px;
          width: 90%;
          margin: 0 auto 50px auto;
        }
        .provider-card {
          background: #fff;
          border-radius: 15px;
          overflow: hidden;
          box-shadow: 0 8px 20px rgba(0,0,0,0.05);
          transition: transform 0.4s ease, box-shadow 0.4s ease;
          position: relative;
          cursor: pointer;
        }
        .provider-card:hover {
          transform: translateY(-10px) scale(1.03);
          box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }
        .provider-card img {
          width: 100%;
          height: 180px;
          object-fit: cover;
          transition: transform 0.5s ease;
        }
        .provider-card:hover img {
          transform: scale(1.1);
        }
        .provider-info {
          padding: 20px;
        }
        .provider-info h5 {
          font-weight: 600;
          color: #333;
          margin-bottom: 8px;
        }
        .provider-info p {
          color: #777;
          font-size: 0.95rem;
          margin-bottom: 12px;
        }
        .provider-info .price {
          color: #ff6600;
          font-size: 1.1rem;
          font-weight: bold;
        }
        .provider-card .book-btn {
          display: inline-block;
          margin-top: 10px;
          background: #ff9900;
          color: #fff;
          padding: 10px 20px;
          border: none;
          border-radius: 30px;
          font-weight: 600;
          transition: background 0.3s, transform 0.3s;
        }
        .provider-card .book-btn:hover {
          background: #e68a00;
          transform: scale(1.05);
        }

        /* Modal Animation */
        .modal-content {
          border-radius: 15px;
        }
        .modal.fade .modal-dialog {
          transform: translateY(50px);
          opacity: 0;
          transition: all 0.4s ease-out;
        }
        .modal.fade.show .modal-dialog {
          transform: translateY(0);
          opacity: 1;
        }

        .profile-pic {
          width: 80px;
          height: 80px;
          border-radius: 50%;
          object-fit: cover;
          margin-bottom: 15px;
        }

        @media (max-width: 576px) {
          .provider-info .price {
            font-size: 1rem;
          }
        }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-custom">
  <div class="container">
     <a class="navbar-brand logo-text" href="{% url 'customer_dashboard' %}">GoService</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="{% url 'customer_dashboard' %}">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'customer_services' %}">Our Services</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'customer_profile' %}">Profile</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'logout' %}">Logout</a></li>
      </ul>
    </div>
  </div>
</nav>

<h2>{{ service_name }} Providers</h2>

<div class="providers-grid">
  {% for provider in providers %}
  <div class="provider-card">
    <img src="{% if provider.provider.user.profile_pic %}{{ provider.provider.user.profile_pic.url }}{% else %}{% static 'main/default_user.png' %}{% endif %}" alt="{{ provider.provider.user.username }}">
    <div class="provider-info">
      <h5>{{ provider.provider.user.username }}</h5>
      <p>Experience: {{ provider.experience }} years</p>
      <p class="price">â‚¹{{ provider.price }}</p>
      <p>{{ provider.address }}</p>
      <button class="book-btn" 
              data-bs-toggle="modal" 
              data-bs-target="#bookModal"
              data-provider="{{ provider.provider.user.username }}"
              data-service="{{ service_name }}"
              data-service-id="{{ provider.service.id }}"
              data-provider-id="{{ provider.provider.id }}">Book</button>
    </div>
  </div>
  {% empty %}
    <p style="text-align:center; color:#ff6600; font-weight:bold;">No providers available for this service.</p>
  {% endfor %}
</div>

<!-- Booking Modal -->
<div class="modal fade" id="bookModal" tabindex="-1" aria-labelledby="bookModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header" style="background: #ff9900; color: white; border-top-left-radius: 15px; border-top-right-radius: 15px;">
        <h5 class="modal-title" id="bookModalLabel">Book Service</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        {% if customer.profile_pic %}
          <img src="{{ customer.profile_pic.url }}" alt="Profile Picture" class="profile-pic">
        {% else %}
          <img src="{% static 'main/default_user.png' %}" alt="Profile" class="profile-pic">
        {% endif %}
        <p><strong>Name:</strong> {{ customer.username }}</p>
        <p><strong>Email:</strong> {{ customer.email }}</p>
        <p><strong>Phone:</strong> {{ customer.customer.phone }}</p>
        <p><strong>Address:</strong> {{ customer.customer.address }}</p>

        <form id="bookingForm">
          <div class="mb-3 text-start">
            <label for="timing">Select Timing</label>
            <select id="timing" class="form-select">
              <option value="">-- Select --</option>
              <option value="9AM-11AM">9AM-11AM</option>
              <option value="11AM-1PM">11AM-1PM</option>
              <option value="1PM-3PM">1PM-3PM</option>
              <option value="3PM-5PM">3PM-5PM</option>
              <option value="5PM-7PM">5PM-7PM</option>
            </select>
          </div>
          <div class="mb-3 text-start">
            <label for="schedule_date">Schedule Date</label>
            <input type="date" id="schedule_date" class="form-control">
          </div>
          <div class="d-flex justify-content-between mt-4">
            <button type="button" class="btn btn-secondary" id="clearBtn">Clear</button>
            <button type="button" class="btn btn-primary" id="proceedBtn">Proceed</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Set min date to today
  document.getElementById('schedule_date').setAttribute('min', new Date().toISOString().split('T')[0]);

  var bookModal = document.getElementById('bookModal');
  bookModal.addEventListener('show.bs.modal', function(event) {
    var button = event.relatedTarget;
    var providerName = button.getAttribute('data-provider');
    var serviceName = button.getAttribute('data-service');
    var serviceId = button.getAttribute('data-service-id');
    var providerId = button.getAttribute('data-provider-id');

    var modalTitle = bookModal.querySelector('.modal-title');
    modalTitle.textContent = 'Book ' + serviceName + ' with ' + providerName;

    var proceedBtn = document.getElementById('proceedBtn');
    proceedBtn.dataset.serviceId = serviceId;
    proceedBtn.dataset.providerId = providerId;
  });

  document.getElementById('clearBtn').addEventListener('click', function() {
    document.getElementById('timing').value = '';
    document.getElementById('schedule_date').value = '';
  });

  document.getElementById('proceedBtn').addEventListener('click', function() {
    var serviceId = this.dataset.serviceId;
    var providerId = this.dataset.providerId;
    var schedule_date = document.getElementById('schedule_date').value;
    var timing = document.getElementById('timing').value;

    if (!schedule_date || !timing) {
      alert('Please select both date and timing.');
      return;
    }

    fetch("{% url 'create_booking' %}", {
      method: 'POST',
      headers: {
        'X-CSRFToken': '{{ csrf_token }}',
        'Content-Type': 'application/x-www-form-urlencoded',
        'X-Requested-With': 'XMLHttpRequest'
      },
      body: `service_id=${serviceId}&provider_id=${providerId}&schedule_date=${schedule_date}&timing=${timing}`
    })
    .then(response => response.json())
    .then(data => {
      if (data.status === 'success') {
        window.location.href = `/users/payment/${data.booking_id}/`;
      } else {
        alert(data.message);
      }
    });
  });
</script>

</body>
</html>
